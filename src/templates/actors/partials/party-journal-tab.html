<section class="journal-tab">
  <div class="journal-header flexrow" style="margin-bottom: 10px; padding: 5px; background: #f0f0f0; border-radius: 3px;">
    <div style="flex: 1;">
      <h3 style="margin: 0;">Party Chronicle</h3>
      <p style="margin: 0; font-size: 0.9em; color: #666;">Record your party's saga, allies, and achievements</p>
    </div>
    <div class="journal-controls" style="display: flex; gap: 5px; align-items: center;">
      {{#if journalLinked}}
        <button class="journal-open" data-tooltip="Open Journal" style="cursor: pointer;">
          <i class="fas fa-book-open"></i> View Full Journal
        </button>
        {{#if simpleQuestActive}}
        <button class="journal-simple-quest" data-tooltip="Open in Simple Quest" style="cursor: pointer;">
          <i class="fas fa-scroll"></i> Simple Quest
        </button>
        {{/if}}
      {{else}}
        <button class="journal-create" data-tooltip="Create Party Journal" style="cursor: pointer;">
          <i class="fas fa-plus-circle"></i> Create Journal
        </button>
      {{/if}}
    </div>
  </div>

  {{#if journalLinked}}
  <div class="journal-entries">

    {{!-- Entry Type Selector --}}
    <div class="entry-add-section" style="margin-bottom: 10px; padding: 10px; background: #e8e8e8; border-radius: 3px;">
      <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
        <div style="display: flex; gap: 5px; align-items: center;">
          <label style="font-weight: bold; margin: 0;">Add New Entry:</label>
          <select class="journal-entry-type" style="padding: 5px;">
            <option value="">-- Select Entry Type --</option>
            <option value="party">Party</option>
            <option value="roster">Roster</option>
            <option value="hireling">Hireling</option>
            <option value="hub">Hub</option>
            <option value="treasure">Treasure</option>
            <option value="quest">Quest</option>
            <option value="ally">Ally</option>
            <option value="rival">Rival</option>
            <option value="session">Session Lore</option>
            <option value="achievement">Achievement</option>
            <option value="graveyard">Graveyard</option>
          </select>
          <button class="journal-add-entry" style="cursor: pointer;">
            <i class="fas fa-plus"></i> Add Entry
          </button>
        </div>
        <div style="margin-left: auto; font-size: 0.9em; color: #666;">
          Total: {{journalEntries.length}} entries
        </div>
      </div>
    </div>

    {{!-- Filters and Sort Controls --}}
    <div class="journal-filters" style="margin-bottom: 10px; padding: 8px; background: #f5f5f5; border: 1px solid #ddd; border-radius: 3px;">
      <div style="display: flex; gap: 15px; flex-wrap: wrap;">
        <div style="flex: 1; min-width: 300px;">
          <div style="margin-bottom: 5px;">
            <label style="font-weight: bold; font-size: 0.9em; margin: 0;">Filter Types:</label>
          </div>
          <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 4px; font-size: 0.85em;">
            <label style="display: flex; align-items: center; gap: 3px; cursor: pointer;">
              <input type="checkbox" class="journal-type-filter" value="party" checked> Party
            </label>
            <label style="display: flex; align-items: center; gap: 3px; cursor: pointer;">
              <input type="checkbox" class="journal-type-filter" value="roster" checked> Roster
            </label>
            <label style="display: flex; align-items: center; gap: 3px; cursor: pointer;">
              <input type="checkbox" class="journal-type-filter" value="hireling" checked> Hireling
            </label>
            <label style="display: flex; align-items: center; gap: 3px; cursor: pointer;">
              <input type="checkbox" class="journal-type-filter" value="hub" checked> Hub
            </label>
            <label style="display: flex; align-items: center; gap: 3px; cursor: pointer;">
              <input type="checkbox" class="journal-type-filter" value="treasure" checked> Treasure
            </label>
            <label style="display: flex; align-items: center; gap: 3px; cursor: pointer;">
              <input type="checkbox" class="journal-type-filter" value="quest" checked> Quest
            </label>
            <label style="display: flex; align-items: center; gap: 3px; cursor: pointer;">
              <input type="checkbox" class="journal-type-filter" value="ally" checked> Ally
            </label>
            <label style="display: flex; align-items: center; gap: 3px; cursor: pointer;">
              <input type="checkbox" class="journal-type-filter" value="rival" checked> Rival
            </label>
            <label style="display: flex; align-items: center; gap: 3px; cursor: pointer;">
              <input type="checkbox" class="journal-type-filter" value="session" checked> Session Lore
            </label>
            <label style="display: flex; align-items: center; gap: 3px; cursor: pointer;">
              <input type="checkbox" class="journal-type-filter" value="achievement" checked> Achievement
            </label>
            <label style="display: flex; align-items: center; gap: 3px; cursor: pointer;">
              <input type="checkbox" class="journal-type-filter" value="graveyard" checked> Graveyard
            </label>
          </div>
        </div>
        <div style="display: flex; flex-direction: column; gap: 5px;">
          <div style="display: flex; gap: 5px; align-items: center;">
            <label style="font-weight: bold; font-size: 0.9em; margin: 0;">Sort:</label>
            <select class="journal-sort-order" style="padding: 4px; font-size: 0.9em;">
              <option value="newest">Newest First</option>
              <option value="oldest">Oldest First</option>
              <option value="type">By Type</option>
            </select>
          </div>
          <button class="journal-clear-filters" style="cursor: pointer; padding: 4px 8px; font-size: 0.9em;" data-tooltip="Reset filters and sort">
            <i class="fas fa-undo"></i> Reset
          </button>
        </div>
      </div>
    </div>

    {{!-- Entry List with Scrollbar --}}
    <div class="journal-entry-list-container" style="max-height: 400px; overflow-y: scroll; overflow-x: hidden; padding-right: 5px;">
      <div class="journal-entry-list">
        {{#each journalEntries as |entry|}}
        <div class="journal-entry-card" data-entry-id="{{entry.id}}" data-entry-type="{{entry.type}}" style="margin-bottom: 15px; padding: 10px; border: 2px solid #ccc; border-radius: 5px; background: white;">

          <div class="entry-header flexrow" style="margin-bottom: 8px; padding-bottom: 5px; border-bottom: 1px solid #ddd;">
            <div style="flex: 1;">
              <span class="entry-type-badge" style="display: inline-block; padding: 2px 8px; background: {{entry.badgeColor}}; color: white; border-radius: 3px; font-size: 0.85em; font-weight: bold; text-transform: uppercase;">
                {{entry.typeLabel}}
              </span>
              {{#if entry.gameDate}}
              <span style="margin-left: 8px; font-size: 0.85em; color: #666;">
                <i class="far fa-calendar"></i> {{entry.gameDate}}
              </span>
              {{/if}}
              {{#if entry.session}}
              <span style="margin-left: 8px; font-size: 0.85em; color: #666;">
                <i class="fas fa-dice-d20"></i> Session {{entry.session}}
              </span>
              {{/if}}
              <span style="margin-left: 8px; font-size: 0.8em; color: #999;">
                <i class="far fa-clock"></i> {{entry.timestampFormatted}}
              </span>
            </div>
            <div class="entry-controls" style="display: flex; gap: 5px;">
              <a class="entry-edit" data-entry-id="{{entry.id}}" title="Edit Entry" style="cursor: pointer;"><i class="fas fa-edit"></i></a>
              <a class="entry-view-page" data-page-id="{{entry.pageId}}" title="View Journal Page" style="cursor: pointer;"><i class="fas fa-book"></i></a>
              <a class="entry-delete" data-entry-id="{{entry.id}}" title="Delete Entry" style="cursor: pointer; color: #a00;"><i class="fas fa-trash"></i></a>
            </div>
          </div>

          <div class="entry-content" style="font-size: 0.95em;">
            {{!-- Content will be rendered based on entry type --}}
            {{#if entry.data}}
              {{#each entry.data as |value key|}}
                {{#if value}}
                <div><strong>{{humanize key}}:</strong> {{{value}}}</div>
                {{/if}}
              {{/each}}
            {{/if}}
          </div>
        </div>
        {{/each}}

        {{#unless journalEntries.length}}
        <div class="no-entries" style="padding: 20px; text-align: center; color: #999; font-style: italic;">
          No journal entries yet. Add your first entry above to begin your party chronicle.
        </div>
        {{/unless}}
      </div>
    </div>

  </div>
  {{else}}
  <div class="no-journal" style="padding: 30px; text-align: center; color: #999;">
    <i class="fas fa-book" style="font-size: 3em; margin-bottom: 10px; opacity: 0.5;"></i>
    <p style="font-size: 1.1em;">No journal linked to this party yet.</p>
    <p style="font-size: 0.9em;">Click "Create Journal" above to begin chronicling your party's adventures.</p>
  </div>
  {{/if}}
</section>
